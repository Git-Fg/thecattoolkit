# Workflow: Summarize Session

## Purpose
Consolidate session state, create comprehensive summary, assess context health, and prepare for potential handoff or continuation.

## When to Use
- Context window approaching 70% (critical threshold)
- End of work session
- Before session rotation
- Major milestone completion
- Switching to different task
- Requesting handoff document

## Required Reading
1. `references/context-structure.md` - Session handoff best practices
2. `templates/handoff.md` - Handoff document template

## Pre-requisites
- Context structure initialized
- Work completed with context tracking
- Scratchpad updated with decisions

## Step 1: Assess Current State

### 1a: Gather Context Files
Verify all context files exist in `.cattoolkit/context/` and check their sizes.

### 1b: Review Scratchpad Entries
Count the number of entries in `.cattoolkit/context/scratchpad.md` by counting timestamped sections.

Review recent entries in the scratchpad to understand current context.

### 1c: Check Context Usage
Estimate token usage in scratchpad.md (approximately 1 word ≈ 1.3 tokens). Check if context window is approaching 70% threshold.

## Step 2: Create Session Summary

### 2a: Generate Summary Document

Create `.cattoolkit/context/session-summary-{YYYYMMDD-HHMM}.md` with the following structure:

```
# Session Summary: {YYYY-MM-DD}

## Session Overview
- **Start Time:** {session-start-time}
- **End Time:** {current-time}
- **Duration:** {calculated-duration}
- **Context Usage:** {estimated-percentage}%

## Completed Work

### Major Milestones
{major-milestones-from-scratchpad}

### Technical Decisions
{technical-decisions-from-scratchpad}

### Errors Resolved
{errors-resolved-from-scratchpad}

## Current State
- **Active Task:** {active-task-from-scratchpad}
- **Current Phase:** {current-phase-from-scratchpad}
- **Progress:** {percentage-or-phase}

## Open Items
{open-questions-from-scratchpad}

## Files Modified
{files-modified-during-session}

## Context Health Assessment

### Completeness
- [ ] Scratchpad updated with major decisions
- [ ] Todos reflect current state
- [ ] Open questions documented
- [ ] Files referenced

### Relevance
- [ ] Recent entries are actionable
- [ ] Decisions have clear rationale
- [ ] Next steps identified
- [ ] No outdated information

### Freshness
- [ ] Last update within session
- [ ] Current phase accurate
- [ ] Active task correct
- [ ] Progress reflects reality

### Conciseness
- [ ] No redundant information
- [ ] Old entries archived
- [ ] Focused on actionable context
- [ ] Token-efficient

## Next Steps
1. {immediate-next-action}
2. {follow-up-action}
3. {future-consideration}

## Recommendations
- {context-related-recommendation-1}
- {context-related-recommendation-2}

---
*Generated by context-engineering summarize-session workflow*
```

### 2b: Review Summary Quality

Review the session summary checklist:
- Duration calculated
- Current state documented
- Next steps identified
- Health assessment complete

## Step 3: Update Context Log

Append to `.cattoolkit/context/context.log`:

```
### {YYYY-MM-DD HH:MM} - Session Summary
- Summary created: session-summary-{YYYYMMDD-HHMM}.md
- Duration: {session-duration}
- Context usage: {percentage}%
- Health score: {score}/100
- Next: {next-action}
```

## Step 4: Update Todos.md

Append to `.cattoolkit/context/todos.md`:

```
## Session Completion - {YYYY-MM-DD}
**Summary:** Session summary created at {HH:MM}
**Duration:** {duration}
**Context Health:** {score}/100
**Status:** Session ended - ready for handoff or continuation
```

## Step 5: Context Health Check

### 5a: Calculate Health Score

Calculate context health across four dimensions (25 points each):

**Completeness (25 points):**
- 15 points: scratchpad.md exists and has substantial content (>10 lines)
- 10 points: todos.md exists

**Relevance (25 points):**
- 10 points: Technical Decisions section present
- 10 points: Open Questions section present
- 5 points: TODO items present

**Freshness (25 points):**
- 15 points: context.log updated today
- 10 points: Recent files modified (<60 minutes)

**Conciseness (25 points):**
- 25 points: scratchpad.md word count <4000 words

Total score = Completeness + Relevance + Freshness + Conciseness (max 100 points)

### 5b: Generate Recommendations

Based on health score:

**Score < 50 (Low health - immediate action needed):**
- Document major decisions in scratchpad.md
- Update todos.md with current tasks
- Create checkpoint for current state

**Score 50-75 (Moderate health - improvement recommended):**
- Add rationale to technical decisions
- Document open questions
- Archive old entries

**Score > 75 (Good health):**
- Continue current tracking practices
- Consider creating checkpoint
- Prepare for session handoff if needed

## Step 6: Decision Point

### 6a: Determine Next Action

Based on estimated context percentage:

**> 80% (CRITICAL - Context overflow risk):**
- Action: Create handoff document immediately

**> 70% (WARNING - Context usage high):**
- Action: Create checkpoint or handoff soon

**> 60% (CAUTION - Context usage moderate):**
- Action: Monitor usage, consider checkpoint

**≤ 60% (Context usage acceptable):**
- Action: Continue work or create optional checkpoint

### 6b: Present Options

**Based on context health and usage, choose:**

**Option 1: Continue Session**
- Context usage <60%
- Health score >75%
- Work not complete
- **Action**: Continue with current context

**Option 2: Create Checkpoint**
- Context usage 60-70%
- Health score >60%
- Milestone reached
- **Action**: Create checkpoint before continuing

**Option 3: Create Handoff**
- Context usage >70%
- Session ending
- Need to preserve state
- **Action**: Use `create-handoff` workflow

**Option 4: Archive and Continue**
- Context large but healthy
- Old entries accumulated
- **Action**: Archive to checkpoint, clean scratchpad

## Step 7: Generate Session Metrics

Create `.cattoolkit/context/session-metrics.json` with the following structure:

```json
{
  "session_date": "{YYYY-MM-DD}",
  "session_start": "{start-time}",
  "session_end": "{YYYY-MM-DD HH:MM}",
  "duration_minutes": {duration},
  "context_files": {
    "scratchpad_entries": {count},
    "todos_active": {count},
    "questions_open": {count}
  },
  "context_health": {
    "score": {score},
    "completeness": {completeness},
    "relevance": {relevance},
    "freshness": {freshness},
    "conciseness": {conciseness}
  },
  "context_usage": {
    "estimated_tokens": {count},
    "percentage": {percentage},
    "threshold_reached": {boolean}
  },
  "recommendations": [
    "{recommendation-1}",
    "{recommendation-2}"
  ]
}
```

## Step 8: Final Validation

Verify the summary is complete:

**Final validation checklist:**
- [ ] Session summary created
- [ ] Health score calculated
- [ ] Context log updated
- [ ] Todos updated
- [ ] Metrics generated
- [ ] Next action determined

**Summary location:** `.cattoolkit/context/session-summary-{YYYYMMDD-HHMM}.md`

## Summary Template

**For quick reference:**

```markdown
# Session Summary: YYYY-MM-DD

## Overview
- Duration: {time}
- Context Usage: {percentage}%
- Health Score: {score}/100

## Completed
- {milestone-1}
- {milestone-2}

## Current State
- Task: {current-task}
- Phase: {current-phase}

## Next
- {next-action-1}
- {next-action-2}

## Recommendation
{continue/checkpoint/handoff}
```

## Best Practices

### When to Summarize
- **Proactive**: At 60% context usage
- **Milestone**: After major completion
- **Session End**: Before stopping work
- **Health Check**: When score <50

### Summary Quality
1. **Accurate**: Reflects true state
2. **Complete**: All major work covered
3. **Actionable**: Clear next steps
4. **Concise**: Focused on essentials
5. **Timestamped**: Date and time included

### Health Maintenance
- Monitor regularly
- Archive old entries
- Update todos frequently
- Document decisions
- Track progress

## Integration

### With Handoff Workflow
Summarize session before creating handoff:
- Summary → Checkpoint → Handoff
- Provides context for handoff
- Ensures continuity

### With Other Skills
- **manage-planning**: Reference phase progress
- **engineering**: Include debugging context
- **git-workflow**: Link to commit history

## Troubleshooting

### Empty Summary
If no work recorded in session summary:
- Check: scratchpad.md updates
- Check: todos.md completion
- Check: git commit history

### Low Health Score
To improve context health:
1. Document missing decisions
2. Update todos.md
3. Add rationale to choices
4. Archive old entries

### Context Bloat
To clean and archive:
1. Archive current scratchpad to checkpoint
2. Keep only recent 50 entries in scratchpad.md
3. Restore from archive if needed

## Next Steps

Based on summary and health assessment:

1. **Continue**: Work with current context
2. **Checkpoint**: Preserve state before continuing
3. **Handoff**: Transfer to new session/tool
4. **Archive**: Clean and reorganize context

Session summary complete. Context state consolidated and assessed.
